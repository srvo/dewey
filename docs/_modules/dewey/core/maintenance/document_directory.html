<!DOCTYPE html>

<html lang="en" data-content_root="../../../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>dewey.core.maintenance.document_directory &#8212; Dewey (TUI) 0.1.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../../_static/pygments.css?v=5ecbeea2" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/basic.css?v=b08954a9" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/alabaster.css?v=27fed22d" />
    <script src="../../../../_static/documentation_options.js?v=01f34227"></script>
    <script src="../../../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" />
   
  <link rel="stylesheet" href="../../../../_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for dewey.core.maintenance.document_directory</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span><span class="w"> </span><span class="nn">argparse</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">hashlib</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">subprocess</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">abc</span><span class="w"> </span><span class="kn">import</span> <span class="n">ABC</span><span class="p">,</span> <span class="n">abstractmethod</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Protocol</span><span class="p">,</span> <span class="n">Tuple</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">dewey.core.base_script</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseScript</span>


<div class="viewcode-block" id="LLMClientInterface">
<a class="viewcode-back" href="../../../../dewey.core.maintenance.html#dewey.core.maintenance.document_directory.LLMClientInterface">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">LLMClientInterface</span><span class="p">(</span><span class="n">Protocol</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Interface for LLM clients.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="LLMClientInterface.generate_content">
<a class="viewcode-back" href="../../../../dewey.core.maintenance.html#dewey.core.maintenance.document_directory.LLMClientInterface.generate_content">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">generate_content</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prompt</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generates content based on the given prompt.&quot;&quot;&quot;</span>
        <span class="o">...</span></div>
</div>



<div class="viewcode-block" id="FileSystemInterface">
<a class="viewcode-back" href="../../../../dewey.core.maintenance.html#dewey.core.maintenance.document_directory.FileSystemInterface">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">FileSystemInterface</span><span class="p">(</span><span class="n">ABC</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Abstract base class for file system operations.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="FileSystemInterface.exists">
<a class="viewcode-back" href="../../../../dewey.core.maintenance.html#dewey.core.maintenance.document_directory.FileSystemInterface.exists">[docs]</a>
    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">exists</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if a file or directory exists.&quot;&quot;&quot;</span>
        <span class="o">...</span></div>


<div class="viewcode-block" id="FileSystemInterface.is_dir">
<a class="viewcode-back" href="../../../../dewey.core.maintenance.html#dewey.core.maintenance.document_directory.FileSystemInterface.is_dir">[docs]</a>
    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">is_dir</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if a path is a directory.&quot;&quot;&quot;</span>
        <span class="o">...</span></div>


<div class="viewcode-block" id="FileSystemInterface.read_text">
<a class="viewcode-back" href="../../../../dewey.core.maintenance.html#dewey.core.maintenance.document_directory.FileSystemInterface.read_text">[docs]</a>
    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">read_text</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Read text from a file.&quot;&quot;&quot;</span>
        <span class="o">...</span></div>


<div class="viewcode-block" id="FileSystemInterface.write_text">
<a class="viewcode-back" href="../../../../dewey.core.maintenance.html#dewey.core.maintenance.document_directory.FileSystemInterface.write_text">[docs]</a>
    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">write_text</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span> <span class="n">content</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Write text to a file.&quot;&quot;&quot;</span>
        <span class="o">...</span></div>


<div class="viewcode-block" id="FileSystemInterface.rename">
<a class="viewcode-back" href="../../../../dewey.core.maintenance.html#dewey.core.maintenance.document_directory.FileSystemInterface.rename">[docs]</a>
    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">rename</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">src</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span> <span class="n">dest</span><span class="p">:</span> <span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Rename a file or directory.&quot;&quot;&quot;</span>
        <span class="o">...</span></div>


<div class="viewcode-block" id="FileSystemInterface.move">
<a class="viewcode-back" href="../../../../dewey.core.maintenance.html#dewey.core.maintenance.document_directory.FileSystemInterface.move">[docs]</a>
    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">move</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">src</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span> <span class="n">dest</span><span class="p">:</span> <span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Move a file or directory.&quot;&quot;&quot;</span>
        <span class="o">...</span></div>


<div class="viewcode-block" id="FileSystemInterface.listdir">
<a class="viewcode-back" href="../../../../dewey.core.maintenance.html#dewey.core.maintenance.document_directory.FileSystemInterface.listdir">[docs]</a>
    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">listdir</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;List directory contents.&quot;&quot;&quot;</span>
        <span class="o">...</span></div>


<div class="viewcode-block" id="FileSystemInterface.mkdir">
<a class="viewcode-back" href="../../../../dewey.core.maintenance.html#dewey.core.maintenance.document_directory.FileSystemInterface.mkdir">[docs]</a>
    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">mkdir</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span> <span class="n">parents</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">exist_ok</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a directory.&quot;&quot;&quot;</span>
        <span class="o">...</span></div>


<div class="viewcode-block" id="FileSystemInterface.stat">
<a class="viewcode-back" href="../../../../dewey.core.maintenance.html#dewey.core.maintenance.document_directory.FileSystemInterface.stat">[docs]</a>
    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">stat</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">os</span><span class="o">.</span><span class="n">stat_result</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the status of a file or directory.&quot;&quot;&quot;</span>
        <span class="o">...</span></div>


<div class="viewcode-block" id="FileSystemInterface.remove">
<a class="viewcode-back" href="../../../../dewey.core.maintenance.html#dewey.core.maintenance.document_directory.FileSystemInterface.remove">[docs]</a>
    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">remove</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Remove a file or directory.&quot;&quot;&quot;</span>
        <span class="o">...</span></div>
</div>



<div class="viewcode-block" id="RealFileSystem">
<a class="viewcode-back" href="../../../../dewey.core.maintenance.html#dewey.core.maintenance.document_directory.RealFileSystem">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">RealFileSystem</span><span class="p">(</span><span class="n">FileSystemInterface</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Real file system operations.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="RealFileSystem.exists">
<a class="viewcode-back" href="../../../../dewey.core.maintenance.html#dewey.core.maintenance.document_directory.RealFileSystem.exists">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">exists</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if a file or directory exists.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">()</span></div>


<div class="viewcode-block" id="RealFileSystem.is_dir">
<a class="viewcode-back" href="../../../../dewey.core.maintenance.html#dewey.core.maintenance.document_directory.RealFileSystem.is_dir">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">is_dir</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if a path is a directory.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">path</span><span class="o">.</span><span class="n">is_dir</span><span class="p">()</span></div>


<div class="viewcode-block" id="RealFileSystem.read_text">
<a class="viewcode-back" href="../../../../dewey.core.maintenance.html#dewey.core.maintenance.document_directory.RealFileSystem.read_text">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">read_text</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Read text from a file.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">path</span><span class="o">.</span><span class="n">read_text</span><span class="p">()</span></div>


<div class="viewcode-block" id="RealFileSystem.write_text">
<a class="viewcode-back" href="../../../../dewey.core.maintenance.html#dewey.core.maintenance.document_directory.RealFileSystem.write_text">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">write_text</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span> <span class="n">content</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Write text to a file.&quot;&quot;&quot;</span>
        <span class="n">path</span><span class="o">.</span><span class="n">write_text</span><span class="p">(</span><span class="n">content</span><span class="p">)</span></div>


<div class="viewcode-block" id="RealFileSystem.rename">
<a class="viewcode-back" href="../../../../dewey.core.maintenance.html#dewey.core.maintenance.document_directory.RealFileSystem.rename">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">rename</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">src</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span> <span class="n">dest</span><span class="p">:</span> <span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Rename a file or directory.&quot;&quot;&quot;</span>
        <span class="n">os</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dest</span><span class="p">)</span></div>


<div class="viewcode-block" id="RealFileSystem.move">
<a class="viewcode-back" href="../../../../dewey.core.maintenance.html#dewey.core.maintenance.document_directory.RealFileSystem.move">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">move</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">src</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span> <span class="n">dest</span><span class="p">:</span> <span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Move a file or directory.&quot;&quot;&quot;</span>
        <span class="kn">import</span><span class="w"> </span><span class="nn">shutil</span>

        <span class="n">shutil</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dest</span><span class="p">)</span></div>


<div class="viewcode-block" id="RealFileSystem.listdir">
<a class="viewcode-back" href="../../../../dewey.core.maintenance.html#dewey.core.maintenance.document_directory.RealFileSystem.listdir">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">listdir</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;List directory contents.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">path</span><span class="p">)</span></div>


<div class="viewcode-block" id="RealFileSystem.mkdir">
<a class="viewcode-back" href="../../../../dewey.core.maintenance.html#dewey.core.maintenance.document_directory.RealFileSystem.mkdir">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">mkdir</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span> <span class="n">parents</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">exist_ok</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a directory.&quot;&quot;&quot;</span>
        <span class="n">path</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="n">parents</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="n">exist_ok</span><span class="p">)</span></div>


<div class="viewcode-block" id="RealFileSystem.stat">
<a class="viewcode-back" href="../../../../dewey.core.maintenance.html#dewey.core.maintenance.document_directory.RealFileSystem.stat">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">stat</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">os</span><span class="o">.</span><span class="n">stat_result</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the status of a file or directory.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">path</span><span class="o">.</span><span class="n">stat</span><span class="p">()</span></div>


<div class="viewcode-block" id="RealFileSystem.remove">
<a class="viewcode-back" href="../../../../dewey.core.maintenance.html#dewey.core.maintenance.document_directory.RealFileSystem.remove">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">remove</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Remove a file or directory.&quot;&quot;&quot;</span>
        <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">path</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="DirectoryDocumenter">
<a class="viewcode-back" href="../../../../dewey.core.maintenance.html#dewey.core.maintenance.document_directory.DirectoryDocumenter">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">DirectoryDocumenter</span><span class="p">(</span><span class="n">BaseScript</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Document directories with code analysis, quality checks, and structural validation.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="DirectoryDocumenter.__init__">
<a class="viewcode-back" href="../../../../dewey.core.maintenance.html#dewey.core.maintenance.document_directory.DirectoryDocumenter.__init__">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">root_dir</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;.&quot;</span><span class="p">,</span>
        <span class="n">llm_client</span><span class="p">:</span> <span class="n">LLMClientInterface</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">fs</span><span class="p">:</span> <span class="n">FileSystemInterface</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initializes the DirectoryDocumenter.</span>

<span class="sd">        Args:</span>
<span class="sd">            root_dir: The root directory to document. Defaults to the current directory.</span>
<span class="sd">            llm_client: The LLM client to use for code analysis.</span>
<span class="sd">            fs: The file system interface.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">config_section</span><span class="o">=</span><span class="s2">&quot;architecture&quot;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;DirectoryDocumenter&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">root_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">root_dir</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conventions_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_path</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_config_value</span><span class="p">(</span>
                <span class="s2">&quot;core.conventions_document&quot;</span><span class="p">,</span> <span class="s2">&quot;../.aider/CONVENTIONS.md&quot;</span>
            <span class="p">),</span>
        <span class="p">)</span>  <span class="c1"># Relative path to CONVENTIONS.md</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">checkpoint_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">root_dir</span> <span class="o">/</span> <span class="s2">&quot;.dewey_documenter_checkpoint.json&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">checkpoints</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_checkpoints</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conventions</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_conventions</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">llm_client</span><span class="p">:</span> <span class="n">LLMClientInterface</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">llm_client</span> <span class="k">if</span> <span class="n">llm_client</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">llm_client</span>
        <span class="p">)</span>  <span class="c1"># type: ignore[assignment]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fs</span><span class="p">:</span> <span class="n">FileSystemInterface</span> <span class="o">=</span> <span class="n">fs</span> <span class="k">if</span> <span class="n">fs</span> <span class="k">else</span> <span class="n">RealFileSystem</span><span class="p">()</span></div>


    <span class="k">def</span><span class="w"> </span><span class="nf">_validate_directory</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Ensure directory exists and is accessible.</span>

<span class="sd">        Raises:</span>
<span class="sd">            FileNotFoundError: If the directory does not exist.</span>
<span class="sd">            PermissionError: If the directory is not accessible.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root_dir</span><span class="p">):</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Directory not found: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">root_dir</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">access</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root_dir</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">R_OK</span><span class="p">):</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Access denied to directory: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">root_dir</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">raise</span> <span class="ne">PermissionError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_load_conventions</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Load project coding conventions from CONVENTIONS.md.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The content of the CONVENTIONS.md file.</span>

<span class="sd">        Raises:</span>
<span class="sd">            FileNotFoundError: If the CONVENTIONS.md file is not found.</span>
<span class="sd">            Exception: If there is an error loading the conventions.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">read_text</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">conventions_path</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Could not find CONVENTIONS.md at </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">conventions_path</span><span class="si">}</span><span class="s2">. Please ensure the path is correct.&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to load conventions: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_load_checkpoints</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Load checkpoint data from file.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A dictionary containing the checkpoint data.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">checkpoint_file</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">read_text</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">checkpoint_file</span><span class="p">))</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Could not load checkpoint file: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">. Starting from scratch.&quot;</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="k">return</span> <span class="p">{}</span>
        <span class="k">return</span> <span class="p">{}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_save_checkpoints</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Save checkpoint data to file.&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">write_text</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">checkpoint_file</span><span class="p">,</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">checkpoints</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not save checkpoint file: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_calculate_file_hash</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_path</span><span class="p">:</span> <span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculate SHA256 hash of file contents with size check.</span>

<span class="sd">        Args:</span>
<span class="sd">            file_path: The path to the file.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The SHA256 hash of the file contents.</span>

<span class="sd">        Raises:</span>
<span class="sd">            Exception: If the hash calculation fails.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">file_size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">stat</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span><span class="o">.</span><span class="n">st_size</span>
            <span class="k">if</span> <span class="n">file_size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">return</span> <span class="s2">&quot;empty_file&quot;</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">file_size</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">hashlib</span><span class="o">.</span><span class="n">sha256</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">())</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Hash calculation failed for </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">raise</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_is_checkpointed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_path</span><span class="p">:</span> <span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if a file has been processed based on content hash.</span>

<span class="sd">        Args:</span>
<span class="sd">            file_path: The path to the file.</span>

<span class="sd">        Returns:</span>
<span class="sd">            True if the file has been processed, False otherwise.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">current_hash</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calculate_file_hash</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">checkpoints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">file_path</span><span class="p">))</span> <span class="o">==</span> <span class="n">current_hash</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not read file to check checkpoint: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_checkpoint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_path</span><span class="p">:</span> <span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Checkpoint a file by saving its content hash.</span>

<span class="sd">        Args:</span>
<span class="sd">            file_path: The path to the file.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">content</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">read_text</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
            <span class="n">content_hash</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">sha256</span><span class="p">(</span><span class="n">content</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">checkpoints</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">file_path</span><span class="p">)]</span> <span class="o">=</span> <span class="n">content_hash</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_save_checkpoints</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not checkpoint file: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<div class="viewcode-block" id="DirectoryDocumenter.analyze_code">
<a class="viewcode-back" href="../../../../dewey.core.maintenance.html#dewey.core.maintenance.document_directory.DirectoryDocumenter.analyze_code">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">analyze_code</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">code</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Analyzes the given code using an LLM and returns a summary.</span>

<span class="sd">        Args:</span>
<span class="sd">            code: The code to analyze.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A tuple containing the analysis and the suggested module.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">prompt</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        Analyze the following code and provide:</span>
<span class="s2">        1.  A summary of its functionality, its dependencies, any potential issues or improvements based on the following conventions.</span>
<span class="s2">        2.  Whether the code contains placeholder code (e.g., &quot;pass&quot;, &quot;TODO&quot;, &quot;NotImplementedError&quot;).</span>
<span class="s2">        3.  Whether it appears to be related to the Dewey project (e.g., by using project-specific imports or code patterns).</span>
<span class="s2">        4.  Suggest a target module within the Dewey project structure (e.g., &quot;core.crm&quot;, &quot;llm.api_clients&quot;, &quot;utils&quot;) for this code.</span>
<span class="s2">            If the code doesn&#39;t fit neatly into an existing module, suggest a new module name.</span>
<span class="s2">            Just return the module name, or None if it&#39;s unclear.</span>

<span class="s2">        </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">conventions</span><span class="si">}</span>

<span class="s2">        ```python</span>
<span class="s2">        </span><span class="si">{</span><span class="n">code</span><span class="si">}</span>
<span class="s2">        ```</span>
<span class="s2">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">llm_client</span><span class="o">.</span><span class="n">generate_content</span><span class="p">(</span><span class="n">prompt</span><span class="p">)</span>
            <span class="c1"># Split the response into analysis and suggested module</span>
            <span class="n">parts</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;4.&quot;</span><span class="p">)</span>
            <span class="n">analysis</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="n">suggested_module</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="o">.</span><span class="n">replace</span><span class="p">(</span>
                    <span class="s2">&quot;Suggest a target module within the Dewey project structure&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;&quot;</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
                <span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span>
                <span class="k">else</span> <span class="kc">None</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="n">analysis</span><span class="p">,</span> <span class="n">suggested_module</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unexpected error during code analysis: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">raise</span></div>


    <span class="k">def</span><span class="w"> </span><span class="nf">_analyze_code_quality</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_path</span><span class="p">:</span> <span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Run code quality checks using flake8 and ruff.</span>

<span class="sd">        Args:</span>
<span class="sd">            file_path: The path to the file.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A dictionary containing the results of the code quality checks.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">results</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;flake8&quot;</span><span class="p">:</span> <span class="p">[],</span> <span class="s2">&quot;ruff&quot;</span><span class="p">:</span> <span class="p">[]}</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Run flake8</span>
            <span class="n">flake8_result</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
                <span class="p">[</span><span class="s2">&quot;flake8&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">file_path</span><span class="p">)],</span>
                <span class="n">capture_output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">text</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">check</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">results</span><span class="p">[</span><span class="s2">&quot;flake8&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">flake8_result</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span>

            <span class="c1"># Run ruff</span>
            <span class="n">ruff_result</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
                <span class="p">[</span><span class="s2">&quot;ruff&quot;</span><span class="p">,</span> <span class="s2">&quot;check&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">file_path</span><span class="p">)],</span>
                <span class="n">capture_output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">text</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">check</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">results</span><span class="p">[</span><span class="s2">&quot;ruff&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ruff_result</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Code quality analysis failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">results</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_analyze_directory_structure</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check directory structure against project conventions.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A dictionary containing the directory structure analysis.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">expected_modules</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;src/dewey/core&quot;</span><span class="p">,</span>
            <span class="s2">&quot;src/dewey/llm&quot;</span><span class="p">,</span>
            <span class="s2">&quot;src/dewey/pipeline&quot;</span><span class="p">,</span>
            <span class="s2">&quot;src/dewey/utils&quot;</span><span class="p">,</span>
            <span class="s2">&quot;ui/screens&quot;</span><span class="p">,</span>
            <span class="s2">&quot;ui/components&quot;</span><span class="p">,</span>
            <span class="s2">&quot;config&quot;</span><span class="p">,</span>
            <span class="s2">&quot;tests&quot;</span><span class="p">,</span>
            <span class="s2">&quot;docs&quot;</span><span class="p">,</span>
        <span class="p">]</span>

        <span class="n">dir_structure</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">deviations</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">root</span><span class="p">,</span> <span class="n">dirs</span><span class="p">,</span> <span class="n">files</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root_dir</span><span class="p">):</span>
            <span class="n">rel_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">root</span><span class="p">)</span><span class="o">.</span><span class="n">relative_to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root_dir</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">part</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">part</span> <span class="ow">in</span> <span class="n">rel_path</span><span class="o">.</span><span class="n">parts</span><span class="p">):</span>
                <span class="k">continue</span>

            <span class="n">dir_structure</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">rel_path</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;files&quot;</span><span class="p">:</span> <span class="n">files</span><span class="p">,</span>
                <span class="s2">&quot;subdirs&quot;</span><span class="p">:</span> <span class="n">dirs</span><span class="p">,</span>
                <span class="s2">&quot;expected&quot;</span><span class="p">:</span> <span class="nb">any</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">rel_path</span><span class="p">)</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">expected_modules</span><span class="p">),</span>
            <span class="p">}</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">dir_structure</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">rel_path</span><span class="p">)][</span><span class="s2">&quot;expected&quot;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">rel_path</span> <span class="o">!=</span> <span class="n">Path</span><span class="p">():</span>
                <span class="n">deviations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">rel_path</span><span class="p">))</span>

        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;structure&quot;</span><span class="p">:</span> <span class="n">dir_structure</span><span class="p">,</span> <span class="s2">&quot;deviations&quot;</span><span class="p">:</span> <span class="n">deviations</span><span class="p">}</span>

<div class="viewcode-block" id="DirectoryDocumenter.generate_readme">
<a class="viewcode-back" href="../../../../dewey.core.maintenance.html#dewey.core.maintenance.document_directory.DirectoryDocumenter.generate_readme">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">generate_readme</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">directory</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span> <span class="n">analysis_results</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate comprehensive README with quality and structure analysis.</span>

<span class="sd">        Args:</span>
<span class="sd">            directory: The directory to generate the README for.</span>
<span class="sd">            analysis_results: A dictionary containing the analysis results.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The content of the README file.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dir_analysis</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_analyze_directory_structure</span><span class="p">()</span>
        <span class="n">expected_modules</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;src/dewey/core&quot;</span><span class="p">,</span>
            <span class="s2">&quot;src/dewey/llm&quot;</span><span class="p">,</span>
            <span class="s2">&quot;src/dewey/pipeline&quot;</span><span class="p">,</span>
            <span class="s2">&quot;src/dewey/utils&quot;</span><span class="p">,</span>
            <span class="s2">&quot;ui/screens&quot;</span><span class="p">,</span>
            <span class="s2">&quot;ui/components&quot;</span><span class="p">,</span>
            <span class="s2">&quot;config&quot;</span><span class="p">,</span>
            <span class="s2">&quot;tests&quot;</span><span class="p">,</span>
            <span class="s2">&quot;docs&quot;</span><span class="p">,</span>
        <span class="p">]</span>

        <span class="n">readme_content</span> <span class="o">=</span> <span class="p">[</span>
            <span class="sa">f</span><span class="s2">&quot;# </span><span class="si">{</span><span class="n">directory</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> Documentation&quot;</span><span class="p">,</span>
            <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">## Code Analysis&quot;</span><span class="p">,</span>
            <span class="o">*</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;### </span><span class="si">{</span><span class="n">fn</span><span class="si">}</span><span class="se">\n</span><span class="si">{</span><span class="n">analysis</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">fn</span><span class="p">,</span> <span class="n">analysis</span> <span class="ow">in</span> <span class="n">analysis_results</span><span class="o">.</span><span class="n">items</span><span class="p">()],</span>
            <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">## Code Quality&quot;</span><span class="p">,</span>
            <span class="o">*</span><span class="p">[</span>
                <span class="sa">f</span><span class="s2">&quot;### </span><span class="si">{</span><span class="n">fn</span><span class="si">}</span><span class="se">\n</span><span class="s2">- Flake8: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;flake8&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2"> issues</span><span class="se">\n</span><span class="s2">- Ruff: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;ruff&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2"> issues&quot;</span>
                <span class="k">for</span> <span class="n">fn</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">analysis_results</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                <span class="k">if</span> <span class="s2">&quot;code_quality&quot;</span> <span class="ow">in</span> <span class="n">data</span>
            <span class="p">],</span>
            <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">## Directory Structure&quot;</span><span class="p">,</span>
            <span class="sa">f</span><span class="s2">&quot;- Expected Modules: </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">expected_modules</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="sa">f</span><span class="s2">&quot;- Structural Deviations (</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">dir_analysis</span><span class="p">[</span><span class="s1">&#39;deviations&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2">):&quot;</span><span class="p">,</span>
            <span class="o">*</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;  - </span><span class="si">{</span><span class="n">d</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">dir_analysis</span><span class="p">[</span><span class="s2">&quot;deviations&quot;</span><span class="p">]],</span>
            <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">## Future Development Plans</span><span class="se">\n</span><span class="s2">TBD&quot;</span><span class="p">,</span>
        <span class="p">]</span>

        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">readme_content</span><span class="p">)</span></div>


<div class="viewcode-block" id="DirectoryDocumenter.correct_code_style">
<a class="viewcode-back" href="../../../../dewey.core.maintenance.html#dewey.core.maintenance.document_directory.DirectoryDocumenter.correct_code_style">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">correct_code_style</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">code</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Corrects the code style of the given code using an LLM based on project conventions.</span>

<span class="sd">        Args:</span>
<span class="sd">            code: The code to correct.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The corrected code.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">prompt</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        Correct the style of the following code to adhere to these conventions:</span>

<span class="s2">        </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">conventions</span><span class="si">}</span>

<span class="s2">        ```python</span>
<span class="s2">        </span><span class="si">{</span><span class="n">code</span><span class="si">}</span>
<span class="s2">        ```</span>
<span class="s2">        Return only the corrected code.</span>
<span class="s2">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">llm_client</span><span class="o">.</span><span class="n">generate_content</span><span class="p">(</span><span class="n">prompt</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;LLM failed to correct code style: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">raise</span></div>


<div class="viewcode-block" id="DirectoryDocumenter.suggest_filename">
<a class="viewcode-back" href="../../../../dewey.core.maintenance.html#dewey.core.maintenance.document_directory.DirectoryDocumenter.suggest_filename">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">suggest_filename</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">code</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Suggests a more human-readable filename for the given code using an LLM.</span>

<span class="sd">        Args:</span>
<span class="sd">            code: The code to suggest a filename for.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The suggested filename.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">prompt</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        Suggest a concise, human-readable filename (without the .py extension) for a Python script</span>
<span class="s2">        that contains the following code.  The filename should be lowercase and use underscores</span>
<span class="s2">        instead of spaces.</span>

<span class="s2">        ```python</span>
<span class="s2">        </span><span class="si">{</span><span class="n">code</span><span class="si">}</span>
<span class="s2">        ```</span>
<span class="s2">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">llm_client</span><span class="o">.</span><span class="n">generate_content</span><span class="p">(</span><span class="n">prompt</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;LLM failed to suggest filename: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span></div>


    <span class="k">def</span><span class="w"> </span><span class="nf">_process_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_path</span><span class="p">:</span> <span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Processes a single file, analyzes its contents, and suggests improvements.</span>

<span class="sd">        Args:</span>
<span class="sd">            file_path: The path to the file.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A tuple containing the analysis and the suggested module, if applicable.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">code</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">read_text</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>

            <span class="c1"># Basic check for project-related code</span>
            <span class="k">if</span> <span class="s2">&quot;src.dewey&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">code</span> <span class="ow">and</span> <span class="s2">&quot;from dewey&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">code</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Skipping </span><span class="si">{</span><span class="n">file_path</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">: Not related to Dewey project.&quot;</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>

            <span class="n">analysis</span><span class="p">,</span> <span class="n">suggested_module</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">analyze_code</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">analysis</span><span class="p">,</span> <span class="n">suggested_module</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to process </span><span class="si">{</span><span class="n">file_path</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_apply_improvements</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">file_path</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span> <span class="n">suggested_module</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Applies suggested improvements to a file, such as moving, renaming, and correcting code style.</span>

<span class="sd">        Args:</span>
<span class="sd">            file_path: The path to the file.</span>
<span class="sd">            suggested_module: The suggested module to move the file to, if applicable.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">file_path</span><span class="o">.</span><span class="n">name</span>
        <span class="c1"># Determine the target path</span>
        <span class="k">if</span> <span class="n">suggested_module</span><span class="p">:</span>
            <span class="n">target_dir</span> <span class="o">=</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">root_dir</span> <span class="o">/</span> <span class="s2">&quot;src&quot;</span> <span class="o">/</span> <span class="s2">&quot;dewey&quot;</span> <span class="o">/</span> <span class="n">suggested_module</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="s2">&quot;/&quot;</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span>
                <span class="n">target_dir</span><span class="p">,</span> <span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span>
            <span class="p">)</span>  <span class="c1"># Ensure the directory exists</span>
            <span class="n">target_path</span> <span class="o">=</span> <span class="n">target_dir</span> <span class="o">/</span> <span class="n">filename</span>
            <span class="n">move_file</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Move </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">target_path</span><span class="si">}</span><span class="s2">? (y/n): &quot;</span><span class="p">,</span>
            <span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">move_file</span> <span class="o">==</span> <span class="s2">&quot;y&quot;</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">target_path</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Moved </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">target_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="n">file_path</span> <span class="o">=</span> <span class="n">target_path</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Failed to move </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">target_path</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                    <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Skipped moving </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>

        <span class="c1"># Suggest a better filename</span>
        <span class="n">code</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">read_text</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
        <span class="n">suggested_filename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">suggest_filename</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">suggested_filename</span><span class="p">:</span>
            <span class="n">new_file_path</span> <span class="o">=</span> <span class="n">file_path</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="p">(</span><span class="n">suggested_filename</span> <span class="o">+</span> <span class="s2">&quot;.py&quot;</span><span class="p">)</span>
            <span class="n">rename_file</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Rename </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">suggested_filename</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39;.py&#39;</span><span class="si">}</span><span class="s2">? (y/n): &quot;</span><span class="p">,</span>
            <span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">rename_file</span> <span class="o">==</span> <span class="s2">&quot;y&quot;</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">new_file_path</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Renamed </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">suggested_filename</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39;.py&#39;</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                    <span class="p">)</span>
                    <span class="n">file_path</span> <span class="o">=</span> <span class="n">new_file_path</span>  <span class="c1"># Update file_path to the new name</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Failed to rename </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">suggested_filename</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39;.py&#39;</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                    <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Skipped renaming </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>

        <span class="c1"># Ask for confirmation before correcting code style</span>
        <span class="n">correct_style</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Correct code style for </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">? (y/n): &quot;</span><span class="p">,</span>
        <span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">correct_style</span> <span class="o">==</span> <span class="s2">&quot;y&quot;</span><span class="p">:</span>
            <span class="n">corrected_code</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">correct_code_style</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">corrected_code</span><span class="p">:</span>
                <span class="c1"># Ask for confirmation before writing the corrected code to file</span>
                <span class="n">write_corrected</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Write corrected code to </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">? (y/n): &quot;</span><span class="p">,</span>
                <span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">write_corrected</span> <span class="o">==</span> <span class="s2">&quot;y&quot;</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">write_text</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">corrected_code</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                            <span class="sa">f</span><span class="s2">&quot;Corrected code style for </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2"> and wrote to file.&quot;</span><span class="p">,</span>
                        <span class="p">)</span>
                    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span>
                            <span class="sa">f</span><span class="s2">&quot;Failed to write corrected code to </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                        <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Corrected code style for </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">, but did not write to file.&quot;</span><span class="p">,</span>
                    <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Failed to correct code style for </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">,</span>
                <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Skipped correcting code style for </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>

<div class="viewcode-block" id="DirectoryDocumenter.process_directory">
<a class="viewcode-back" href="../../../../dewey.core.maintenance.html#dewey.core.maintenance.document_directory.DirectoryDocumenter.process_directory">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">process_directory</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">directory</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Processes the given directory, analyzes its contents, and generates a README.md file.</span>

<span class="sd">        Args:</span>
<span class="sd">            directory: The directory to process.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">directory_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">directory</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">directory_path</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">is_dir</span><span class="p">(</span><span class="n">directory_path</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Directory &#39;</span><span class="si">{</span><span class="n">directory</span><span class="si">}</span><span class="s2">&#39; not found.&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="n">analysis_results</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">directory_path</span><span class="p">):</span>
            <span class="n">file_path</span> <span class="o">=</span> <span class="n">directory_path</span> <span class="o">/</span> <span class="n">filename</span>
            <span class="k">if</span> <span class="n">file_path</span><span class="o">.</span><span class="n">suffix</span> <span class="o">==</span> <span class="s2">&quot;.py&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_checkpointed</span><span class="p">(</span><span class="n">file_path</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Skipping checkpointed file: </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="k">continue</span>

                <span class="n">analysis</span><span class="p">,</span> <span class="n">suggested_module</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_process_file</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">analysis</span><span class="p">:</span>
                    <span class="n">analysis_results</span><span class="p">[</span><span class="n">filename</span><span class="p">]</span> <span class="o">=</span> <span class="n">analysis</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_apply_improvements</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">suggested_module</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_checkpoint</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>  <span class="c1"># Checkpoint after processing</span>

        <span class="n">readme_content</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_readme</span><span class="p">(</span><span class="n">directory_path</span><span class="p">,</span> <span class="n">analysis_results</span><span class="p">)</span>
        <span class="n">readme_path</span> <span class="o">=</span> <span class="n">directory_path</span> <span class="o">/</span> <span class="s2">&quot;README.md&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">write_text</span><span class="p">(</span><span class="n">readme_path</span><span class="p">,</span> <span class="n">readme_content</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Generated README.md for </span><span class="si">{</span><span class="n">directory</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to write README.md: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="DirectoryDocumenter.run">
<a class="viewcode-back" href="../../../../dewey.core.maintenance.html#dewey.core.maintenance.document_directory.DirectoryDocumenter.run">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Processes the entire project directory.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">root</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_files</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root_dir</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">process_directory</span><span class="p">(</span><span class="n">root</span><span class="p">)</span></div>


<div class="viewcode-block" id="DirectoryDocumenter.execute">
<a class="viewcode-back" href="../../../../dewey.core.maintenance.html#dewey.core.maintenance.document_directory.DirectoryDocumenter.execute">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Executes the directory documentation process.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">run</span><span class="p">()</span></div>
</div>



<div class="viewcode-block" id="main">
<a class="viewcode-back" href="../../../../dewey.core.maintenance.html#dewey.core.maintenance.document_directory.main">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Main entry point for the script.&quot;&quot;&quot;</span>
    <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">(</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Document a directory by analyzing its contents and generating a README file.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--directory&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;The directory to document (defaults to project root).&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="s2">&quot;.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>

    <span class="n">documenter</span> <span class="o">=</span> <span class="n">DirectoryDocumenter</span><span class="p">(</span><span class="n">root_dir</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">directory</span><span class="p">)</span>
    <span class="n">documenter</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span></div>



<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../../../index.html">Dewey (TUI)</a></h1>









<search id="searchbox" style="display: none" role="search">
    <div class="searchformwrapper">
    <form class="search" action="../../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" placeholder="Search"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script><h3>Navigation</h3>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../../../index.html">Documentation overview</a><ul>
  <li><a href="../../../index.html">Module code</a><ul>
  <li><a href="../../../dewey.html">dewey</a><ul>
  </ul></li>
  </ul></li>
  </ul></li>
</ul>
</div>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2025, Sloane Ortel.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 8.2.3</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 1.0.0</a>
      
    </div>

    

    
  </body>
</html>